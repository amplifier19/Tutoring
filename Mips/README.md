# MIPS Assembly

<br></br>

## Τύποι Δεδομένων

### Χαρακτήρας

- Ένας **Χαρακτήρας** στον MIPS καταλαμβάνει μνήμη ίση με `1 byte` (8 bits). Επομένως για την δήλωση μιας μεταβλητής τύπου Χαρακτήρα, στον MIPS χρησιμοποιούμε το declarative `.byte`
- Κατά την δήλωση μιας μεταβλητής, μπορούμε να την αρχικοποιήσουμε με μία τιμή, για παράδειγμα εάν η τιμή της μεταβλητής δεν πρόκειται να αλλάξει κατά την διάρκεια εκτέλεσης του προγράμματος.

  ```
  .data
      char: .byte 'K'
  .text
  ```

### String

- Στον MIPS ένα **string** αποτελείται από τους χαρακτήρες που περιέχει, καθώς και το τερματικό σύμβολο `null`.
- Στην πράξη, οι χαρακτήρες αποθηκεύονται στην μνήμη ως αριθμοί (ASCII κωδικός του χαρακτήρα). Στην περίπτωση του τερματικού συμβόλου, ο κωδικός ASCII είναι το 0.
- Για την δήλωση ενός string στον MIPS χρησιμοποιείται το declarative `.space` μαζί με το `πλήθος` των χαρακτήρων. Στον buffer `str` μπορούν να αποθηκευτόυν 49 χαρακτήρες, μαζί με το τερματικό σύμβολο null.

  ```
  .data
      str: .space 50
  .text
  ```

- Εάν θέλουμε να δηλώσουμε ένα string, το οποίο δεν πρόκειται να αλλάξει κατά την εκτέλεση του προγράμματος, τότε χρησιμοποιούμε το declarative `.asciiz`
- Στην παρακάτω δήλωση, το str περιέχει το `"Hello"` μαζί με τον τερματικό χαρακτήρα `null`.
- **Προσοχή**, εάν χρησιμοποιήσουμε το declarative `.ascii`, δεν θα προστεθεί το τερματικό σύμβολο στο τέλος. **_Δεν συνίσταται!!!_**

  ```
  .data
      str: .asciiz "Hello"
  .text
  ```

### Ακέραιοι αριθμοί

- Ένας `Ακέραιος` αριθμός μονής ακρίβειας, καταλαμβάνει μνήμη ίση με `8 bytes` (32 bits). Επομένως στον MIPS, για την δήλωση ενός ακέραιου χρησιμοποιείται το declarative `.word`
- Μία λέξη (word), σε επεξεργαστές όπως ο MIPS, έχει μέγεθος 32 bit, δηλαδή 8 bytes.
- Κατά την δήλωση μιας ακέραιας μεταβλητής, π.χ. `num`, μπορούμε να την αρχικοποιήσουμε με μία τιμή, π.χ. 10, όπως φαίνεται παρακάτω.

  ```
  .data
      num: .word 10
  .text
  ```

  <br></br>

## Εντολές Input - Output

### Δίαβασμα Χαρακτήρα

- Για το διάβασμα ενός χαρακτήρα γίνεται κλήση συστήματος **`syscall`** με **`κωδικό 12`**.
- Μετά την κλήση συστήματος ο χαρακτήρας βρίσκεται αποθηκευμένος στον καταχωρήτητη `$v0`.
- Επειδή ο καταχωρητής `$v0` χρησιμοποιείται σε `syscall`, καλό είναι να αποθηκεύσουμε τον χαρακτήρα (δηλαδή τον ASCII κωδικό του), σε έναν άλλον καταχωρητή, π.χ. `$s0-$s3` ή `$a2-$a3` ή `$t0-$t3 `.

  ```
  .data
  .text
  main:
      li $v0,12
      syscall

      # Αντίστοιχο του: move $a3, $v0 (ψευδο-εντολή)
      la $a2,$v0
      lb $a3,($a2)
  ```

### Τύπωμα Χαρακτήρα

- Για το τύπωμα ενός χαρακτήρα γίνεται κλήση συστήματος **`syscall`** με **`κωδικό 12`**.
- Το σύστημα κατά το `syscall`, τυπώνει το περιεχόμενο του καταχωρητή `$a0`. Επομένως ο χαρακτήρας που θέλουμε να τυπώσουμε, θα πρέπει να βρίσκεται αποθηκευμένος στον καταχωρητή `$a0`.
- Στο παρακάτω code snippet, στη μεταβλητή `char` έχουμε αποθηκεύσει την τιμή `new-line`. Αρχικά φορτώνουμε (`la`) την `Δ.Μ.` της `char` στον `$a1` και ύστερα αντιγράφουμε (`lb`) το περιεχόμενο μεγέθους `1 byte` ξεκινώντας από εκείνη την Δ.Μ. (`$a1`).

  ```
  .data
      char: .byte '\n'
  .text
  main:
      # Αντίστοιχο του: move $a0,char
      la $a1,char
      lb $a0,($a1)

      li $v0, 11
      syscall
  ```

### Διάβασμα String

- Το διάβασμα ενός string, αντιστοιχεί στην κλήση συστήματος **`syscall`** με **`κωδικό 8`**.
- Πριν το διάβασμα του string, θα πρέπει να έχει φορτωθεί (`la`) η `Δ.Μ.` του buffer `str` στον καταχωρητή `$a0`. Επίσης πρέπει να φορτωθεί (`li`) το `πλήθος` των χαρακτήρων που θα διαβαστούν, στον καταχωρητή `$a1`, π.χ. 16.
- Μετά το διάβασμα του string, τα περιεχόμενα έχουν αποθηκευτεί στην μνήμη, ξεκινώντας από την `Δ.Μ.` του buffer `str`.

  ```
    .data
        str: .space 16
    .text
    main:
        la $a0,str
        li $a1,16

        li $v0,8
        syscall
  ```

### Τύπωση String

- Για την τύπωση ενός string πραγματοποιείται **`syscall`** με **`κωδικό 4`**.
- Για την τύπωση ενός string, ο καταχωρητής `$a0`, πρέπει να περιέχει την `Δ.Μ.` του string. Επομένως, αρχικά, φορτώνουμε την Δ.Μ. (`la`) του str στον $a0.
- Το σύστημα τυπώνει τα περιεχόμενα, ξεκινώντας από την Δ.Μ. ($a0) μέχρι να βρεί τον τεματικό χαρακτήρα `null`.

  ```
  .data
      str: .asciiz "hello world"  # ή str: .space 50 στην περίπτωση που,
                                  # το str πρόκειται να διαβαστεί πρώτα από τον χρήστη
  .text
  main:
      la $a0,str

      li $v0,4
      syscall
  ```

### Διάβασμα Ακέραιου

- Για το διάβασμα ενός ακέραιου αριθμού πραγματοποιείται **`syscall`** με **`κωδικό 5`**.
- Μετά το syscall ο ακέραιος βρίσκεται αποθηκευμένος στον καταχωρητή `$v0`
- Ύστερα _συνίσταται_, η αντιγραφή του ακεραίου σε έναν άλλον καταχωρητή, π.χ. στον $a2.
- Για την αντιγραφή του ακεραίου, πρώτα φορτώνεται η Δ.Μ. του `$v0` στον `$a1` και ύστερα φορτώνεται η λέξη (`word`, δηλαδή ο ακέραιος) στον καταχωρητή `$a2`

  ```
  .data
  .text
  main:
      li $v0,5
      syscall

      # Αντίστοιχο του: move $a2,$v0
      la $a1,$v0
      lw $a2,($a1)
  ```

### Τύπωμα Ακεραίου

- Για το τύπωμα ενός ακέραιου αριθμού πραγματοποιείται **`syscall`** με **`κωδικό 1`**.
- Πρίν το τύπωμα, ο ακέραιος αριθμός που θα τύπωθεί, πρέπει να βρίσκεται αποθηκευμένος στον καταχωρητή `$a0`.

  ```
  .data
      num: .word 50
  .text
  main:
      # Αντίστοιχο του:  move $a0,num
      la $a1,num
      lw $a0,($a1)

      li $v0,1
      syscall

  ```

  <br></br>

## Loops - Βρόγχοι

### Προσπέλαση και Τύπωση Ακεραίων

```
.data
    numbers: .word 10, -5, 20, 30
    count: .word 4
.text
main:
    # Αντίστοιχο με: move $a3,count
    la $a2,count
    lw $a3,($a2)

    addi $a3,-1

    la $s0, numbers
loop: beqz $a3, exit
      # Αντιγραφή του περιεχομένου της Δ.Μ. $s0 στον $a0
      lw $a0,($s0)
      li $v0,1
      syscall

      # Αυξάνουμε την Δ.Μ. $s0 κατά 4, επειδή οι ακέραιοι καταλαμβάνουν 4 bytes
      addi $s0,4
      # Μειώνουμε κατά 1, το πλήθος των ακεραίων που έχουμε να τυπώσουμε
      addi $a3,-1
j loop

exit: li $v0,10
      syscall
```

### Προσπέλαση String και καταμέτρηση των Χαρακτήρων του

```
.data
	  str: .asciiz "Hello"
.text
main:
    # Φόρτωση της Δ.Μ. του str στον $a2
	  la $a2,str
    # Στον $a3 φορτώνεται o χαρακτήρας που έχει αποθηκευτεί στην Δ.Μ. $a2
    lb $a3,($a2)

    # Ο $t2 είναι ο μετρητής χαρακτήρων και ξεκινά από το 0
    li $t2,0

      # Έλεγχος του χαρακτήρα $a3 εάν είναι ο 0 (ΑSCII code 0 -> null)
loop: beqz $a3,exit

      # Άυξηση του μετρητή $t2 κατά ένα
      addi $t2,$t2,1
      # Άυξηση της Δ.Μ. $a2 κατά 1, εφόσον ένας χαρακτήρας καταλαμβάνει 1 byte
      addi $a2,$a2,1
      # Φόρτωση του χαρακτήρα στον $a3
      lb $a3,($a2)
j loop

      # Τύπωση της τιμής του μετρητή $t2
exit: la $t3,$t2
      lw $a0,($t3)
      li $v0,1
      syscall

      # Τερματισμός Προγράμματος
      li $v0,10
      syscall
```
